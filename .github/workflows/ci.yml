---
name: Build and test

on: [push]

jobs:
  linux-test:
    runs-on: ubuntu-20.04
    steps:
    - uses: actions/checkout@v3
    - name: Install dependencies
      run: sudo apt-get install -y gcc g++
    - name: Compile C file
      run: gcc examples/covercrypt.c -Wall -Wextra -Werror -o covercrypt_c -I include/ -L lib/ -lcloudproof
    - name: Compile C++ file
      run: g++ examples/covercrypt.cpp -Wall -Wextra -Werror -o covercrypt_cpp -I include/ -L lib/ -lcloudproof
    - name: Run C file example
      run: LD_LIBRARY_PATH=lib ./covercrypt_c
    - name: Run C++ file example
      run: LD_LIBRARY_PATH=lib ./covercrypt_cpp
  macos-test:
    runs-on: macos-12
    steps:
    - uses: actions/checkout@v3
    - name: Compile C file
      run: gcc examples/covercrypt.c -Wall -Wextra -Werror -o covercrypt_c -I include/ -L lib/ -lcloudproof
    - name: Compile C++ file
      run: g++ examples/covercrypt.cpp -Wall -Wextra -Werror -o covercrypt_cpp -I include/ -L lib/ -lcloudproof
    - name: Run C file example
      run: DYLD_FALLBACK_LIBRARY_PATH=lib ./covercrypt_c
    - name: Run C++ file example
      run: DYLD_FALLBACK_LIBRARY_PATH=lib ./covercrypt_cpp
